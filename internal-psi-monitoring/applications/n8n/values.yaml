# 1. MAIN APPLICATION SETTINGS
main:
  count: 1
  # ADDED: Configuration block for environment variables
  config:
    # Fix for the "Spinning Setup" issue
    N8N_PUSH_BACKEND: "websocket" 
    # Since you are running locally for now
    N8N_HOST: "localhost"
    N8N_PROTOCOL: "http"
    # Essential for credentials security
    N8N_ENCRYPTION_KEY: "your-random-32-char-string-here"
    # Enables community nodes as requested
    N8N_ENABLE_COMMUNITY_NODES: "true"

  pdb:
    enabled: true
    minAvailable: 1
    maxUnavailable: null

  resources: 
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 2000m
      memory: 1Gi

  livenessProbe:
    httpGet:
      path: /healthz
      port: http

  readinessProbe:
    httpGet:
      path: /healthz/readiness
      port: http

# 2. DATABASE CONFIGURATION
db:
  type: postgresdb
  postgresdb:
    poolSize: 2
    connectionTimeout: 20000
    idleConnectionTimeout: 30000
    schema: public
    ssl:
      enabled: true
      rejectUnauthorized: false
  
# 3. EXTERNAL POSTGRESQL (Root level for this chart)
externalPostgresql:
  host: pg-1e155c21-oyegokeodev-f11d.f.aivencloud.com
  username: n8n_user
  port: 20109
  database: n8n
  existingSecret: n8n-db-secret # Key must be 'password' inside the secret

# 4. INGRESS (AWS ALB)
ingress:
  enabled: true
  className: alb
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/group.name: "psi-monitoring"
    alb.ingress.kubernetes.io/group.order: "20"
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/healthcheck-path: /healthz
  hosts:
    - host: n8n.example.com
      paths:
        - path: /
          pathType: Prefix